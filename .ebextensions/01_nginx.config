files:
  "/etc/nginx/conf.d/01_app.conf":
    mode: "000644"
    owner: root
    group: root
    content: |
      server {
          listen 80 default_server;
          listen [::]:80 default_server;
          server_name _;
          
          root /var/app/current/dist;
          index index.html;
          
          # Handle client-side routing
          location / {
              try_files $uri $uri/ /index.html;
          }
          
          # Cache static assets
          location ~* \.(js|css|png|jpg|jpeg|gif|ico|svg|woff|woff2|ttf|eot)$ {
              expires 1y;
              add_header Cache-Control "public, immutable";
          }
          
          # Security headers
          add_header X-Frame-Options "SAMEORIGIN" always;
          add_header X-Content-Type-Options "nosniff" always;
          add_header Referrer-Policy "no-referrer-when-downgrade" always;
      }

commands:
  01_remove_default_nginx:
    command: "rm -f /etc/nginx/conf.d/default.conf"
  02_reload_nginx:
    command: "service nginx reload"